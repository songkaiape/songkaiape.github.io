> 前言：Flask一直是我很喜欢的一个框架，之前学习框架的时候便是看了Miguel的Flask教程，现在他正在更新一系列新的Flask的教程，所以边尝试将其翻译给大家。翻译如果有不恰当的地方，请大家多多包涵和指正。

欢迎！您即将开始学习如何使用Python和Flask框架创建Web应用程序。上面的视频将为您提供本教程内容的概述。在第一章中，您将学习如何设置Flask项目。在本章的最后，您将在您的计算机上运行一个简单的Flask Web应用程序！

以下是本系列文章的列表，供大家参考。

- 第1章：你好，世界！（本文）
- 第2章：模板
- 第3章：Web窗体
- 第4章：数据库
- 第5章：用户登录
- 第6章：配置文件页面和头像
- 第7章：错误处理
- 第8章：如何添加关注
- 第9章：分页
- 第10章：电子邮件支持
- 第11章：改头换面（2018年2月13日发布）
- 第12章：日期和时间（2018年2月20日可用）
- 第13章：I18n和L10n （2018年2月27日发布）
- 第14章：Ajax （2018年3月6日发布）
- 第15章：更好的应用程序结构（2018年3月13日发布）
- 第16章：全文搜索（2018年3月20日发布）
- 第17章：Linux 上的部署（2018年3月27日发布）
- 第18章：Heroku的部署（2018年4月3日发布）
- 第19章：Docker容器部署（2018年4月10日发布）
- 第20章：一些JavaScript Magic （2018年4月17日发布）
- 第21章：用户通知（2018年4月24日发布）
- 第22章：后台工作（2018年5月1日发布）
- 第23章：应用程序编程接口（API）（2018年5月8日发布）
*注1：如果您正在寻找本教程的旧版本，它就在这里。*

*注2：如果您想支持我在此博客上的工作，或者只是没有耐心等待每周文章，我将提供本教程的完整版本，打包成电子书或一组视频。有关更多信息，请访问learn.miguelgrinberg.com。*

本教程中提供的所有代码示例都托管在GitHub存储库上。从GitHub下载代码可以为您节省很多打字量，但我强烈建议您自己输入代码，至少在前几章中是这样。一旦您对Flask和示例应用程序更加熟悉，如果输入过于繁琐，则可以直接从GitHub访问代码。

在每章的开头，我将给你提供三个GitHub链接，这些链接在你阅读本章的过程中很有用。该浏览链接将打开GitHub的仓库中**Microblog**的地方，那是你在阅读的这一章做出的代码更改，而不包括后续章节将要增加的代码。该**Zip**链接是一个下载链接，一个包含整个应用程序以及这一章中所以的代码的压缩文件。该**DIFF**链接将打开一个以图形化展示的页面，其中包括了所有你将阅读的这一章所做的更改。

本章的GitHub链接是：[Browse](https://github.com/miguelgrinberg/microblog/tree/v0.1)，[Zip](https://github.com/miguelgrinberg/microblog/archive/v0.1.zip)，[Diff](https://github.com/miguelgrinberg/microblog/compare/v0.0...v0.1)。

# 安装Python
如果您的计算机上没有安装Python，请现在去安装。如果您的操作系统不提供Python包，则可以从[Python官方网站](http://python.org/download/)下载安装程序。如果您使用的是Microsoft Windows以及WSL或Cygwin，请注意您不能使用Windows的本机版Python，而是需要从Ubuntu（如果你使用WSL）或从Cygwin获得的Unix友好版本。

为了确保你的Python安装功能正常，你可以打开一个终端窗口并键入*python3*，或者如果这不起作用的话,试试*python*。以下是您应该看到的内容：
```
$ python3
Python 3.5.2 (default, Nov 17 2016, 17:05:23)
[GCC 5.4.0 20160609] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>>>_
```
Python解释器现在正在等待交互提示，您可以在其中输入Python语句。在将来的章节中，您将了解此交互式提示对于哪些内容有用。但是现在，您已经确认Python已安装在您的系统上。要退出交互式提示，您可以键入exit()并按Enter键。在Linux和Mac OS X版本的Python上，您还可以通过按Ctrl-D退出解释器。在Windows上，退出快捷键是Ctrl-Z，加上Enter。

# 安装Flask
下一步是安装Flask，但在开始之前，我想告诉你有关安装Python 包的最佳实践。

在Python中，Flask等软件包在公共存储库中可用，任何人都可以从中下载并安装它们。官方的Python软件包库称为[PyPI](https://pypi.python.org/pypi)，它代表Python Package Index（有些人也称这个库为“奶酪店”）。从PyPI安装软件包非常简单，因为Python带有一个叫做pip这个工具的工具（在Python 2.7中pip并没有捆绑Python并且需要单独安装）。

要在您的机器上安装一个python包，可以按照以下方式使用pip：
```
$ pip install <package-name>
```
有趣的是，这种安装软件包的方法在大多数情况下不起作用。如果您的Python解释器是为您的计算机的所有用户全局安装的，那么您的普通用户帐户可能无权修改它，因此运行上述命令的唯一方法是从管理员帐户。但即使没有这种复杂的事情，考虑一下在安装上述软件包时会发生什么。该pip工具将从PyPI下载软件包，然后将其添加到Python installation中。从这一刻开始，您系统上的每个Python脚本都可以访问这个包。想象一下，您已经使用Flask的0.11版本完成了一个Web应用程序的情况，Flask在启动时是Flask的最新版本，但现在已经被版本0.12取代。您现在想要启动第二个应用程序，您希望使用0.12版本，但如果替换已安装的0.11版本，则可能会破坏较早的应用程序。你看到问题了吗？如果可以安装供旧应用程序使用的Flask 0.11，并且为您的新应用程序安装Flask 0.12，那将是理想选择。

为了解决为不同应用程序维护不同版本的软件包的问题，​​Python使用虚拟环境的概念。虚拟环境是Python解释器的完整副本。在虚拟环境中安装软件包时，系统范围的Python解释器不受影响，只有副本是。因此，完全自由地为每个应用程序安装任何版本的软件包的解决方案是为每个应用程序使用不同的虚拟环境。虚拟环境具有额外的好处，即它们由创建它们的用户所拥有，所以它们不需要管理员帐户。

我们首先创建一个项目所在的目录。我打算叫这个目录*microblog*，因为这是应用程序的名称：
```
$ mkdir microblog
$ cd microblog
```
如果您使用的是Python 3版本，则其中包含虚拟环境支持，因此您只需创建一个即可：
```
$ python3 -m venv venv
```
用这个命令，我让Python运行这个`venv`包，它创建了一个名为的虚拟环境`venv`。`venv`命令中的第一个是Python虚拟环境软件包的名称，第二个是我将用于此特定环境的虚拟环境名称。如果你觉得这样很混乱，你可以用`venv`你想分配给你的虚拟环境的不同名字替换第二个名字。一般来说，我使用`venv`项目目录中的名称创建我的虚拟环境，因此无论何时cd进入项目时，都会找到其相应的虚拟环境。

请注意，在某些操作系统中，您可能需要使用**python**而不是**python3**上面的命令。一些安装包使用*python*用于Python 2.x版本而用*python3* 对应3.x版本，而另一些则使用*python*对应3.x版本。

命令完成后，您将拥有一个名为venv的虚拟环境文件存储目录。

如果您正在使用任何一个早于3.4版本的Python（包括2.7版本），则python本身不支持虚拟环境。对于这些版本的Python，在创建虚拟环境之前，您需要下载并安装名为virtualenv的第三方工具。一旦安装了virtualenv，您可以使用以下命令创建虚拟环境：
```
$ virtualenv venv
```
无论您使用何种方法创建它，您都应该已经创建了您的虚拟环境。现在你必须告诉系统你想要使用它，并且通过激活它来实现。要激活您的全新虚拟环境，请使用以下命令：
```
$ source venv/bin/activate
(venv) $ _
```
如果您使用的是Microsoft Windows命令提示符窗口，则激活命令稍有不同：
```
$ venv\Scripts\activate
(venv) $ _
```
当你激活一个虚拟环境时，终端会话的配置被修改，这样它里面存储的Python解释器就是你输入时调用的解释器python。另外，终端提示符被修改为包括激活的虚拟环境的名称。对终端会话所做的更改对于该会话来说都是临时的和私有的，因此在关闭终端窗口时它们不会保留。如果您同时打开多个终端窗口，则每个虚拟环境都可以激活不同的虚拟环境。

现在您已创建并激活了一个虚拟环境，可以在其中安装Flask：
```
(venv) $ pip install flask
```
如果要确认您的虚拟环境已经安装了**Flask**，就可以启动Python解释器并导入Flask:
```
>>> import flask
>>> _
```
如果上述命令没有任何错误，你可以庆祝一下了，因为Flask已经安装并且可以使用。

# 一个“Hello, World” Flask应用程序
如果您访问[Flask网站](http://flask.pocoo.org/)，那么您将获得一个仅有五行代码的非常简单的示例应用程序。与其重复那个微小的例子，我会告诉你一个稍微复杂一点的例子，它将为您编写大型应用程序提供一个良好的基础结构。

该应用程序将存在于一个包中。在Python中，包含`__init__.py`文件的子目录被视为一个包，并且可以导入。当您导入一个包时，`__init__.py`会执行并定义该包暴露给外界的符号。

我们来创建一个名为的包app，它将托管应用程序。确保您位于*microblog*目录中，然后运行以下命令：
```
(venv) $ mkdir app
```
该`__init__.py`的app包是要包含以下代码：

`app / __ init__.py`：Flask应用程序实例
```python
from flask import Flask

app = Flask(__name__)

from app import routes
```
上面的脚本只是将应用程序对象创建了从包中导入的一个Flask类的实例。`__name__`传递给Flask该类的变量是一个Python预定义变量，它被设置为当前模块的名称。当需要加载相关资源（如模板文件）时，Flask将使用此处传递的模块的位置作为起点，我将在第2章中介绍这些资源。实际上，使用`__name__`是一种配置Flask经常使用而且正确的方式。然后应用程序导入`routes`，当然这个模块还不存在。

一个开始令人疑惑的方面是有两个实体叫`app`。该`app`包由`app`目录和`__init__.py`脚本定义的，并在`from app import routes`语句中引用。该`app`变量在`__init__.py`文件中被定义为一个`Flask`类的实例在，这使得它成为`app`包的成员。

另一个特点是`routes`模块在底部导入，而不是脚本的顶部，这是一种常见的用法。底部导入是对解决**循环导入**的方法，这是一个Flask应用程序的常见问题。您将看到routes模块需要导入app此脚本中定义的变量，因此将其中一个导入放在底部可以避免由于这两个文件之间的相互引用而导致的错误。

那么`routes`模块中是些什么？`路由`是应用程序实现的不同URL。在Flask中，应用程序路由的处理程序被编写为Python函数，称为视图函数。视图函数被映射到一个或多个路由URL，以便Flask知道当客户端请求给定的URL时要执行什么逻辑。

这是您的第一个视图函数，您需要在名为app / routes.py的新模块中编写这个函数：
```python
#app / routes.py：主页路由

from app import app

@app.route('/')
@app.route('/index')
def index():
    return "Hello, World!"
```
这个视图函数实际上很简单，它只是以字符串形式返回问候语。`@app.route`函数上面的两条奇怪行是装饰器，这是Python语言的一个独特功能。装饰器修改它后面的功能。使用装饰器的一个常见场景是使用它们将函数注册为某些事件的回调。在这种情况下，`@app.route`装饰器在作为参数给出的URL和函数之间创建一个关联。在这个例子中有两个装饰器，它们将URL` /`和`/index`到这个功能。这意味着当Web浏览器请求这两个URL中的任何一个时，Flask将调用此函数并将其返回值作为响应传递回浏览器。可能这不是很容易理解，不过你会在运行这个程序的时候加深一些理解。

要完成应用程序，您需要在定义Flask应用程序实例的顶层使用Python脚本。我们来调用这个脚本`microblog.py`，并将其定义为一个导入应用程序实例的行：
```
#microblog.py：主应用程序模块

from app import app
```
还记得这两个`app`实体么？在这里，你可以在同一句代码中看到两者。Flask应用程序实例被称为`app`并且是`app`包的成员。该`from app import app`语句导入`app`作为`app`包成员的变量。如果你觉得这样很混乱，你可以重新命名包或者变量。

为了确保您正确地做到了一切，下面您可以看到迄今为止的项目结构图：
```
microblog/
  venv/
  app/
    __init__.py
    routes.py
  microblog.py
```
相信与否，这个应用程序的第一个版本现在完成了！然而，在运行它之前，需要告诉Flask如何导入它，方法是设置`FLASK_APP`环境变量：
```
(venv) $ export FLASK_APP=microblog.py
```
如果使用的是微软Windows，在上面的命令里使用`set`而不是`export`。

你准备见证奇迹了么？您可以使用以下命令运行您的第一个Web应用程序：
```
(venv) $ flask run
 * Serving Flask app "microblog"
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
```
服务器初始化后将等待客户端连接。`flask run` 的输出表明服务器正在IP地址127.0.0.1上运行，这一般是您本地计算机的地址。这个地址非常常见，也有一个更简单的名字，你可能以前看过：`localhost`。网络服务器侦听特定端口号的连接。部署在生产Web服务器上的应用程序通常在端口443上进行监听，如果不执行加密，则有时会监听80，但对这些端口的访问需要管理权限。由于此应用程序在开发环境中运行，因此Flask使用免费的端口5000.现在打开您的Web浏览器并在地址字段中输入以下URL：

    `http://localhost:5000/`
或者，您可以使用这个网址：

    `http://localhost:5000/index`
您是否理解了这个网址路由映射？第一个URL映射到`/`，而第二个映射到`/index`。两个路由都与应用程序中唯一的视图函数关联，因此它们产生相同的输出，即函数会返回相同的字符串。如果您输入任何其他URL，则会出现错误，因为只有这两个URL可以被应用程序识别。

`你好，世界！`

当你玩腻了服务器后，你可以按Ctrl-C来停止它。

恭喜，您已经完成了成为Web开发人员的第一步
